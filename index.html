<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gallery: M·ªü/ƒê√≥ng L·ªùi Ch√∫c ‚Äî N·ªÅn Sao & Tuy·∫øt</title>
<style>
  :root{
    --bg1: #423f9e;
    --bg2: #9c5cf0;
    --accent: #0b7a68;
    --card-w: 140px;
    --card-h: 100px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background: linear-gradient(180deg,var(--bg1),var(--bg2));overflow:hidden;color:#e6fff7}

  /* CANVASES - background layers */
  canvas#stars{
    position:fixed; left:0; top:0; width:100%; height:100%; z-index:40; pointer-events:none;
  }
  canvas#snow{
    position:fixed; left:0; top:0; width:100%; height:100%; z-index:900; pointer-events:none;
  }

  /* twinkle lights (string of lights) */
  .lights {
    position: fixed; left: 50%; transform: translateX(-50%); top: 12px;
    display:flex; gap:10px; z-index:980; pointer-events:none;
  }
  .lights .bulb {
    width:10px; height:10px; border-radius:50%;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 0 6px rgba(255,255,255,0.8);
    opacity:0.9;
    animation: twinkle 2.6s infinite;
  }
  .lights .bulb:nth-child(2n){ animation-delay: .4s; background: #ffd1e1; box-shadow:0 0 8px #ffd1e1;}
  .lights .bulb:nth-child(3n){ animation-delay: .8s; background: #fff6b3; box-shadow:0 0 8px #fff6b3;}
  .lights .bulb:nth-child(4n){ animation-delay: 1.1s; background: #bfefff; box-shadow:0 0 8px #bfefff;}
  @keyframes twinkle {
    0% { transform: scale(0.9); opacity: 0.6; filter:blur(0px); }
    50% { transform: scale(1.4); opacity: 1; filter:blur(1px); }
    100% { transform: scale(0.9); opacity: 0.6; filter:blur(0px); }
  }

  /* header area with toggle */
  header{
    position: fixed; left: 0; right: 0; top: 12px; display:flex; justify-content:center; z-index:3000; pointer-events:none;
  }
  .controls{pointer-events:auto; display:flex; gap:12px; align-items:center;}
  .btn{
    background:var(--accent); color:white; border:0; padding:10px 16px; border-radius:12px;
    cursor:pointer; font-weight:700; box-shadow:0 8px 30px rgba(11,122,104,0.12);
  }
  .btn.secondary{background:transparent;color:var(--accent);border:1px solid rgba(11,122,104,0.14)}

  /* stage (where cards are appended) */
  #stage{position:fixed; inset:0; overflow:hidden; z-index:1000;}

  /* each card (image) */
  .card{
    position:absolute;
    width:var(--card-w);
    height:var(--card-h);
    display:block;
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 10px 30px rgba(0,0,0,0.45);
    cursor:pointer;
    user-select:none;
    touch-action:none;
    transform-origin:center center;
    transition:transform .18s ease;
    z-index:1100; /* above snow but below header controls */
  }
  .card img{ width:100%; height:100%; object-fit:cover; display:block; filter: saturate(1.05) contrast(1.03); }

  /* caption overlay on each card */
  .card .caption{
    position:absolute;
    left:8px; right:8px; bottom:8px;
    background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.45));
    color:#fff;
    padding:8px 10px;
    border-radius:8px;
    font-weight:500;
    font-size:9px;
    box-shadow:0 8px 18px rgba(0,0,0,0.35);
    opacity:0;
    transform:translateY(8px) scale(.98);
    transition:opacity .28s ease, transform .28s ease;
    pointer-events:none;
    text-align:left;
    line-height:1.2;
  }
  .card.showCaption .caption{ opacity:1; transform:translateY(0) scale(1); }

  /* running text under cards (low z-index so cards overlay it) */
  .running-text{ position:fixed; left:0; right:0; bottom:14px; text-align:center; z-index:60; pointer-events:none; font-weight:700; color:#fff; text-shadow:0 0 8px rgba(0,0,0,0.3); font-size:15px; }
  .running-text div{ display:inline-block; padding-left:100%; animation: ticker 18s linear infinite; }
  @keyframes ticker { 0% { transform:translateX(0) } 100% { transform:translateX(-100%) } }

  /* small toast for autoplay blocked */
  .toast { position:fixed; right:18px; top:64px; background:rgba(0,0,0,0.72); color:#fff; padding:8px 12px; border-radius:10px; z-index:3100; display:none; }

  /* responsive adjustments */
  @media (max-width:640px){
    :root{ --card-w: 110px; --card-h: 86px; }
    .btn{ padding:8px 12px; font-size:13px }
    .running-text{ font-size:13px }
    .lights{ gap:6px; top:8px; }
  }
</style>
</head>
<body>
  <!-- stars background (behind everything) -->
  <canvas id="stars"></canvas>

  <!-- twinkle lights (above stars, under cards) -->
  <div class="lights" aria-hidden="true">
    <div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div>
    <div class="bulb"></div><div class="bulb"></div><div class="bulb"></div>
  </div>

  <!-- title and controls -->
  <h1 style="position:fixed;top:18px;left:50%;transform:translateX(-50%);color:#fff;z-index:3200;text-shadow:0 0 10px #fff,0 0 18px #ffd1e1;font-weight:3000">üå∏ Ch√∫c M·ª´ng 20/10 üå∏</h1>
  <button id="musicToggle" aria-pressed="true" class="btn" style="position:fixed;top:12px;right:18px;z-index:3200;padding:8px 12px">üîä</button>
  <div class="toast" id="toast">Tr√¨nh duy·ªát c√≥ th·ªÉ ch·∫∑n autoplay. B·∫•m n√∫t g√≥c ph·∫£i ƒë·ªÉ b·∫≠t nh·∫°c.</div>

  <!-- stage (cards) -->
  <main id="stage" aria-live="polite"></main>

  <!-- running text under balloons/cards -->
<!--  <div class="running-text" aria-hidden="true"><div>üíê Ch√∫c m·ª´ng Ng√†y Ph·ª• N·ªØ Vi·ªát Nam üíê</div></div>-->

  <!-- snow canvas (in front of stars, behind cards) -->
  <canvas id="snow"></canvas>

  <!-- audio -->
<!--  <audio id="bgMusic" loop preload="auto">-->
<!--    <source src="https://cdn.jsdelivr.net/gh/anshumanv/ambient-music/piano-romantic.mp3" type="audio/mpeg">-->
<!--  </audio>-->

<!--<div class="music-control" id="musicBtn">üîä T·∫Øt nh·∫°c</div>-->
<audio id="bgMusic" autoplay loop>
  <source src="nhacnen.mp3" type="audio/mpeg">
</audio>
<script>
/* ========== STARS: background twinkling stars ========== */
const starsCanvas = document.getElementById('stars');
const sCtx = starsCanvas.getContext('2d');
function resizeStars(){ starsCanvas.width = window.innerWidth; starsCanvas.height = window.innerHeight; }
resizeStars(); window.addEventListener('resize', resizeStars);

const stars = [];
function initStars(count=160){
  stars.length = 0;
  const w = starsCanvas.width, h = starsCanvas.height;
  for(let i=0;i<count;i++){
    stars.push({
      x: Math.random()*w,
      y: Math.random()*h,
      r: Math.random()*1.6 + 0.3,
      baseAlpha: Math.random()*0.6 + 0.2,
      twinkleSpeed: Math.random()*0.02 + 0.005,
      phase: Math.random()*Math.PI*2
    });
  }
}
initStars(Math.min(260, Math.floor(window.innerWidth/5)));

function drawStars(){
  sCtx.clearRect(0,0,starsCanvas.width, starsCanvas.height);
  const t = performance.now();
  for(const st of stars){
    const alpha = st.baseAlpha * (0.6 + 0.4*Math.sin(st.phase + t*st.twinkleSpeed));
    sCtx.beginPath();
    const g = sCtx.createRadialGradient(st.x, st.y, 0, st.x, st.y, st.r*6);
    g.addColorStop(0, `rgba(255,255,255,${alpha})`);
    g.addColorStop(1, `rgba(255,255,255,0)`);
    sCtx.fillStyle = g;
    sCtx.arc(st.x, st.y, st.r*4, 0, Math.PI*2);
    sCtx.fill();
  }
  requestAnimationFrame(drawStars);
}
requestAnimationFrame(drawStars);

/* ========== SNOW: falling particles ========== */
const snowCanvas = document.getElementById('snow');
const snCtx = snowCanvas.getContext('2d');
function resizeSnow(){ snowCanvas.width = window.innerWidth; snowCanvas.height = window.innerHeight; }
resizeSnow(); window.addEventListener('resize', resizeSnow);

const flakes = [];
function spawnFlake(){
  const w = snowCanvas.width, h = snowCanvas.height;
  flakes.push({
    x: Math.random()*w,
    y: -10 - Math.random()*h*0.3,
    r: Math.random()*4 + 2,
    vx: (Math.random()-0.5)*0.6,
    vy: 0.6 + Math.random()*1.2,
    rot: Math.random()*Math.PI*2,
    vr: (Math.random()-0.5)*0.02,
    opacity: 0.6 + Math.random()*0.4,
    color: ['#fff','#fff5f8','#fff7e6'][Math.floor(Math.random()*3)]
  });
}
for(let i=0;i<38;i++) spawnFlake();

function drawSnow(){
  snCtx.clearRect(0,0,snowCanvas.width, snowCanvas.height);
  for(let i=flakes.length-1;i>=0;i--){
    const f = flakes[i];
    f.x += f.vx;
    f.y += f.vy;
    f.rot += f.vr;
    snCtx.save();
    snCtx.globalAlpha = f.opacity;
    snCtx.translate(f.x, f.y);
    snCtx.rotate(f.rot);
    // draw simple petal-like ellipse
    snCtx.beginPath();
    snCtx.ellipse(0, 0, f.r, f.r*0.7, 0, 0, Math.PI*2);
    snCtx.fillStyle = f.color;
    snCtx.fill();
    snCtx.restore();
    if(f.y > snowCanvas.height + 20) flakes.splice(i,1);
  }
  if(flakes.length < 38 && Math.random() < 0.6) spawnFlake();
  requestAnimationFrame(drawSnow);
}
requestAnimationFrame(drawSnow);

/* ========== MAIN: cards moving randomly + toggle captions ========== */
const IMAGE_COUNT = 20;
const imgSeeds = Array.from({length: IMAGE_COUNT}).map((_,i)=>`https://picsum.photos/seed/card${i+1}/400/300`);
const messages = [
  '‚Ä¶.nguy·ªát l∆∞u quang soi v·∫°n l√Ω\n‚Ä¶.t√¢m tr·∫°ch sƒ© qu·∫ßn anh t·ª±u\n‚Ä¶.khu√™ thanh t√∫ r·∫°ng tr·∫ßn th·∫ø\n‚Ä¶.ch·ªß ƒë·∫°t ƒë·∫°o th·∫•u mu√¥n t√¨nh (15)',
  'Thanh t√¢m nh∆∞·ª£c th·ªßy\nH·ªìn d·∫≠t ‚Ä¶. kh√≠\n(14)',
  '‚Ä¶. lai nh√¢n th·∫ø\nNh·∫•t ti·∫øu khuynh th√†nh\n(13)',
  'Quan tƒ©nh hoa l·∫°c\n√ù Thi·ªán th√†nh ‚Ä¶.\n(12)',
  'Nh√¢n h·ªØu minh ‚Ä¶.\nV·∫°n s·ª± kh·∫£ th√†nh\n(11)',
  '‚Ä¶. hoa h·ªØu m·ªã\nB·∫•t t·∫°i k·ª≥ s·∫Øc\n(10)',
  'Th·∫ø h·∫£i ƒëa lu√¢n\nCh√¢n t√¢m dƒ© bi·∫øn\nTinh v√¢n v√¥ ƒë·ªãnh\n‚Ä¶. t√¢m v√¥ di\n(9)',
  '‚Ä¶. v·∫≠n t∆∞∆°ng t√πy\nH·∫£o s·ª± giai lai\n(8)',
  'Kim ‚Ä¶. ho√° v≈©\nƒê·∫ø kh√≠ th·ªãnh sinh\nThi√™n t√†ng ƒë·ªãa b·∫£o\nNh·∫•t th·∫ø v∆∞∆°ng ƒë·ªì\n(7)',
  '‚Ä¶. tu·∫•n ki·ªát v√¢n th∆∞·ª£ng ƒë·ªôc h√†nh\nMinh nguy·ªát ƒë·ªìng quan t·ª±u t∆∞∆°ng dung\n(6)',
  'Ho·∫£ luy·ªán ki√™n t√¢m\nKim sinh ‚Ä¶. ki·∫øm\nKi·∫øm ‚Ä¶. v√¥ vi\nNhu ƒë·ªông ch·∫ø c∆∞∆°ng\n(5)',
  'Y·∫øn ‚Ä¶. t·∫•u kh√∫c v√¢n phi√™u\nM·∫∑c v·∫≠n phi√™u nhi√™n t·ª± h·ªça\n(4)',
  'Hoa ‚Ä¶. nan ho·∫° b√∫t\nƒê√†o ‚Ä¶. dƒ© ƒëo·∫°t t√¢m\nT·ªãnh s·∫Øc song k√¨ tuy·ªát\nM·ªπ kh·ªüi b·∫•t nƒÉng c·∫ßm\n(3)',
  '‚Ä¶. vi hoa ch·ª©ng\nM·ªπ t·∫°i tri nh√¢n\n(2)',
  'D·∫° ‚Ä¶. g·∫•m y ·∫©n th·ª•\nXu√¢n tƒ©nh, thu l·∫°c, ƒë√¥ng nh√†n, h·∫° c√°t\n(1)',
];
const stage = document.getElementById('stage');
const cards = [];

// create cards
for(let i=0;i<IMAGE_COUNT;i++){
  const el = document.createElement('div');
  el.className = 'card';
  el.tabIndex = 0;
  const img = document.createElement('img');
  img.src = imgSeeds[i];
  img.alt = `H√¨nh ${i+1}`;
  el.appendChild(img);
  const cap = document.createElement('div');
  cap.className = 'caption';
  cap.innerText = messages[i % messages.length];
  el.appendChild(cap);
  stage.appendChild(el);

  // random initial pos & velocity
  const rectW = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--card-w')) || 140;
  const rectH = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--card-h')) || 100;
  let x = Math.random() * (window.innerWidth - rectW);
  let y = 80 + Math.random() * (window.innerHeight - 200);
  let vx = (Math.random() - 0.5) * 1.2;
  let vy = (Math.random() - 0.5) * 1.0;
  cards.push({el, x, y, vx, vy, w: rectW, h: rectH});
  el.style.transform = `translate3d(${Math.round(x)}px,${Math.round(y)}px,0)`;
}

// animation loop
let last = performance.now();
function animateCards(ts){
  const dt = (ts - last)/1000; last = ts;
  const W = window.innerWidth, H = window.innerHeight;
  for(const c of cards){
    c.vx += (Math.random()-0.5)*0.06;
    c.vy += (Math.random()-0.5)*0.04;
    c.vx = Math.max(-2.0, Math.min(2.0, c.vx));
    c.vy = Math.max(-1.8, Math.min(1.8, c.vy));
    c.x += c.vx;
    c.y += c.vy;
    if(c.x < 6){ c.x = 6; c.vx *= -1; }
    if(c.y < 72){ c.y = 72; c.vy *= -1; }
    if(c.x > W - c.w - 6){ c.x = W - c.w - 6; c.vx *= -1; }
    if(c.y > H - c.h - 6){ c.y = H - c.h - 6; c.vy *= -1; }
    const rot = Math.sin((performance.now()/1000) + c.x*0.01) * 6;
    c.el.style.transform = `translate3d(${Math.round(c.x)}px,${Math.round(c.y)}px,0) rotate(${rot}deg)`;
  }
  requestAnimationFrame(animateCards);
}
requestAnimationFrame(animateCards);

/* Toggle show/hide captions for all cards ‚Äî v·ªã tr√≠ n√∫t chuy·ªÉn sang g√≥c tr√°i */
const toggleBtn = document.createElement('button');
toggleBtn.className = 'btn';
toggleBtn.style.position = 'fixed';
toggleBtn.style.left = '18px';          // üëà ƒê·∫∑t ·ªü g√≥c tr√°i
toggleBtn.style.top = '64px';           // üëà D∆∞·ªõi d√≤ng ti√™u ƒë·ªÅ m·ªôt ch√∫t
toggleBtn.style.zIndex = 3200;
toggleBtn.textContent = 'Hi·ªán l·ªùi ch√∫c';
toggleBtn.setAttribute('aria-pressed', 'false');
document.body.appendChild(toggleBtn);

let captionsVisible = false;
toggleBtn.addEventListener('click', ()=>{
  captionsVisible = !captionsVisible;
  toggleBtn.innerText = captionsVisible ? '·∫®n l·ªùi ch√∫c' : 'Hi·ªán l·ªùi ch√∫c';
  toggleBtn.setAttribute('aria-pressed', String(captionsVisible));
  for(const c of cards){
    if(captionsVisible) c.el.classList.add('showCaption');
    else c.el.classList.remove('showCaption');
  }
});

/* Shuffle button: ƒë·∫∑t k·∫ø b√™n b√™n ph·∫£i c·ªßa n√∫t l·ªùi ch√∫c */
const shuffleBtn = document.createElement('button');
shuffleBtn.className = 'btn secondary';
shuffleBtn.style.position = 'fixed';
shuffleBtn.style.left = '150px';        // üëà C√°ch n√∫t ƒë·∫ßu ti√™n m·ªôt kho·∫£ng
shuffleBtn.style.top = '64px';
shuffleBtn.style.zIndex = 3200;
shuffleBtn.textContent = 'X√°o v·ªã tr√≠';
document.body.appendChild(shuffleBtn);
shuffleBtn.addEventListener('click', ()=>{
  const W = window.innerWidth, H = window.innerHeight;
  for(const c of cards){
    c.x = Math.random() * (W - c.w);
    c.y = 80 + Math.random() * (H - 200);
    c.vx = (Math.random() - 0.5) * 1.6;
    c.vy = (Math.random() - 0.5) * 1.2;
    const rot = Math.sin((performance.now()/1000) + c.x*0.01) * 6;
    c.el.style.transform = `translate3d(${Math.round(c.x)}px,${Math.round(c.y)}px,0) rotate(${rot}deg)`;
  }
});

/* Accessibility: Enter toggles captions; Escape hides */
window.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter') { toggleBtn.click(); }
  if(e.key === 'Escape') { if(captionsVisible){ toggleBtn.click(); } }
});

/* Resize update */
window.addEventListener('resize', ()=>{
  const rectW = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--card-w')) || 140;
  const rectH = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--card-h')) || 100;
  for(const c of cards){ c.w = rectW; c.h = rectH; }
});

/* ========== Music autoplay handling & toggle ========== */
const bgMusic = document.getElementById('bgMusic');
const musicToggle = document.getElementById('musicToggle');
const toast = document.getElementById('toast');
let audioCtx = null;

window.addEventListener('load', ()=> {
  bgMusic.volume = 0.75;
  const p = bgMusic.play();
  if(p !== undefined){
    p.then(()=> {
      musicToggle.classList.add('playing'); musicToggle.textContent = 'üîä'; musicToggle.setAttribute('aria-pressed','true');
    }).catch(()=> {
      toast.style.display = 'block'; setTimeout(()=> toast.style.display = 'none', 4200);
      musicToggle.classList.remove('playing'); musicToggle.textContent = 'üîà'; musicToggle.setAttribute('aria-pressed','false');
    });
  }
});

musicToggle.addEventListener('click', async ()=>{
  if(bgMusic.paused){
    try { if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); if(audioCtx.state === 'suspended') await audioCtx.resume(); }catch(e){}
    try { await bgMusic.play(); }catch(e){}
    musicToggle.classList.add('playing'); musicToggle.textContent='üîä'; musicToggle.setAttribute('aria-pressed','true');
  } else {
    bgMusic.pause();
    musicToggle.classList.remove('playing'); musicToggle.textContent='üîà'; musicToggle.setAttribute('aria-pressed','false');
  }
});

/* ========== Initialization: responsive star count based on width ========== */
function resetBackground(){
  const count = Math.min(300, Math.max(80, Math.floor(window.innerWidth/4)));
  initStars(count);
}
resetBackground();
window.addEventListener('resize', resetBackground);

/* ========== End of script ========= */
</script>
</body>
</html>
